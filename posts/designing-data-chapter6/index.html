<!DOCTYPE html><html lang="ko-KR" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="06장. 파티셔닝" /><meta name="author" content="Bae Sangwoo" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="대용량 데이터셋을 파티셔닝하는 몇 가지 방법을 살펴보고 인덱스와 파티셔닝이 어떻게 상호작용하는지 살펴보자 클러스터에 노드를 추가하거나 제거할 때 필요한 재균형화(리밸런싱)에 대해서 살펴보자 데이터베이스가 어떻게 요청을 올바른 파티션에 전달하고 질의를 실행하는지 살펴보자" /><meta property="og:description" content="대용량 데이터셋을 파티셔닝하는 몇 가지 방법을 살펴보고 인덱스와 파티셔닝이 어떻게 상호작용하는지 살펴보자 클러스터에 노드를 추가하거나 제거할 때 필요한 재균형화(리밸런싱)에 대해서 살펴보자 데이터베이스가 어떻게 요청을 올바른 파티션에 전달하고 질의를 실행하는지 살펴보자" /><link rel="canonical" href="https://bswsw.github.io/posts/designing-data-chapter6/" /><meta property="og:url" content="https://bswsw.github.io/posts/designing-data-chapter6/" /><meta property="og:site_name" content="bveloper" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-08T22:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="06장. 파티셔닝" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Bae Sangwoo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Bae Sangwoo"},"dateModified":"2025-01-12T12:28:02+09:00","datePublished":"2025-01-08T22:00:00+09:00","description":"대용량 데이터셋을 파티셔닝하는 몇 가지 방법을 살펴보고 인덱스와 파티셔닝이 어떻게 상호작용하는지 살펴보자 클러스터에 노드를 추가하거나 제거할 때 필요한 재균형화(리밸런싱)에 대해서 살펴보자 데이터베이스가 어떻게 요청을 올바른 파티션에 전달하고 질의를 실행하는지 살펴보자","headline":"06장. 파티셔닝","mainEntityOfPage":{"@type":"WebPage","@id":"https://bswsw.github.io/posts/designing-data-chapter6/"},"url":"https://bswsw.github.io/posts/designing-data-chapter6/"}</script><title>06장. 파티셔닝 | bveloper</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="bveloper"><meta name="application-name" content="bveloper"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/bveloper.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">bveloper</a></div><div class="site-subtitle font-italic">bveloper</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/bswsw" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['baegoony','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>06장. 파티셔닝</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img data-src="https://wikibook.co.kr/images/cover/l/9791158393601.jpg" class="preview-img bg" alt="Preview Image" data-proofer-ignore><h1 data-toc-skip>06장. 파티셔닝</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/bswsw">BAE SANGWOO</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" data-ts="1736341200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-01-08 </em> </span> <span> 업데이트 <em class="timeago" data-ts="1736652482" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2025-01-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5778 단어"> <em>32 분</em>읽는 시간</span></div></div></div><div class="post-content"><blockquote><p>대용량 데이터셋을 파티셔닝하는 몇 가지 방법을 살펴보고 인덱스와 파티셔닝이 어떻게 상호작용하는지 살펴보자 클러스터에 노드를 추가하거나 제거할 때 필요한 재균형화(리밸런싱)에 대해서 살펴보자 데이터베이스가 어떻게 요청을 올바른 파티션에 전달하고 질의를 실행하는지 살펴보자</p></blockquote><h2 id="0-파티셔닝"><span class="mr-2">0. 파티셔닝</span><a href="#0-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>데이터셋이 매우 크거나 질의 처리량이 매우 높다면 복제만으로는 부족하고 데이터를 파티션으로 쪼갤 필요가 있는 이 작업을 샤딩이라고 함<li>여기서 말하는 파티션은?<ul><li>몽고DB, 엘라스틱서치, 솔라클라우드의 샤드에 해당함<li>HBase: 리전<li>빅테이블: 테블릿<li>카산드라/리악: 브이노드(vnode)<li>카우치베이스: 브이버켓(vBucket)</ul><li>파티셔닝의 주된 이유는 확장성<li>비공유 클러스터(shard-nothing cluster)에서 다른 파티션은 다른 노드에 저장될 수 있음<li>대용량 데이터셋이 여러 디스크에 분산될 수 있고 질의 부하는 여러 프로세서에 분산될 수 있음<li>각 노드에서 자신의 파티션에 해당하는 질의를 독립적으로 실행할 수 있으므로 노드를 추가함으로써 질의 처리량을 늘릴 수 있음<ul><li>여러 노드에서 병렬 실행이 가능함</ul></ul><h2 id="1-파티셔닝과-복제"><span class="mr-2">1. 파티셔닝과 복제</span><a href="#1-파티셔닝과-복제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>보통 복제와 파티셔닝을 함께 적용해 각 파티션의 복사본을 여러 노드에 저장<ul><li>여러 다른 노드에 데이터를 저장하여 내결함성을 보장할 수 있다는 의미</ul><li>한 노드에 여러 파티션을 저장할 수도 있음<ul><li>리더/팔로워 복제 모델을 사용한다면 각 파티션의 리더는 하나의 노드에 할당됨<li>각 노드는 파티션에 따라 리더이면서 팔로워가 될 수 있음</ul><li>5장 복제에 대한 모든 내용은 파티션의 복제에도 동일하게 적용됨</ul><h2 id="2-키-값-데이터-파티셔닝"><span class="mr-2">2. 키-값 데이터 파티셔닝</span><a href="#2-키-값-데이터-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>파티셔닝의 목적은 데이터와 질의 부하를 노드 사이에 고르게 분산시키는 것<li>트래픽이 동일하다면 10대의 노드를 사용하면 한 대를 사용할 때보다 10배의 데이터를 저장, 쓰기 요청 처리가 가능 (일단 복제 무시)<li>특정 파티션에 데이터가 많거나 질의를 많이 받으면 <strong>쏠렸다(skewed)</strong>고 말함<ul><li>파티셔닝의 효과가 매우 떨어짐<li>모든 부하가 한 파티션에 몰려 병목이 될 수 있음<li>불균형하게 부하가 높은 파티션: <strong>핫스팟</strong></ul><li>핫스팟을 회피하는 가장 단순한 방법<ul><li>레코드를 할당할 노드를 무작위로 선택<li>어떤 레코드를 읽으려고 할 때 레코드가 어느 노드에 저장됐는지 알 수 없으므로 모든 노드 병렬 질의 필요</ul><li>단순한 키-값 모델<ul><li>기본키를 통해 레코드에 접근<li>예시) 백과사전 알파벳 순 정렬</ul></ul><h3 id="21-키-범위-기준-파티셔닝"><span class="mr-2">2.1. 키 범위 기준 파티셔닝</span><a href="#21-키-범위-기준-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>백과사전처럼 각 파티션에 연속된 범위의 키를 할당하는 것<li>각 범위들 사이의 경계를 알면 키가 어느 파티션에 속하는지 쉽게 찾을 수 있음<li>어떤 파티션이 어느 노드에 할당됐는지 알면 적절한 노드로 요청을 직접 보낼 수 있음<li>키 범위가 동일할 필요는 없으나 데이터를 고르게 분산시키려면 파티션 경계를 데이터에 맞춰 조정해야 함<li>파티션의 경계는 관리자가 수동으로 선택하거나 데이터베이스에서 자동으로 선택되게 할 수 있음<ul><li>파티션 재균형화<li>빅테이블, HBase, 리싱크DB, 몽고DB 2.4 이전</ul><li>각 파티션의 키를 정렬된 순서로 저장 가능 (SS테이블, LSM 트리)<li>키를 연쇄된 색인으로 간주해서 질의 하나로 관련 레코드 여러 개를 읽어오는데 사용 가능 (범위 질의)<ul><li>다중 칼럼 색인<li>키를 타임스탬프로 사용하는 경우</ul><li>키 범위 기준 파티셔닝은 패턴에 따라 핫스팟을 유발하는 단점이 존재<li>회피 방법<ul><li>키의 첫 번째 요소로 타임스탬프가 아닌 다른 것을 사용<li>만약 이름을 첫 번째 키로 사용한다면 이름 마다 범위 질의가 필요함</ul></ul><h3 id="22-키의-해시값-기준-파티셔닝"><span class="mr-2">2.2. 키의 해시값 기준 파티셔닝</span><a href="#22-키의-해시값-기준-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>핫스팟 위험으로 많은 분산 데이터스토어는 키의 파티션을 정하는 데 해시 함수를 사용함<li>좋은 해시 함수는 쏠린 데이터를 입력으로 받아 균일하게 분산되게 함<li>파티셔닝용 해시 함수는 암호적으로 강력할 필요 없음<ul><li>카산드라, 몽고DB: MD5<li>볼드모트: 파울러 놀 보(Fowler-Noll-Vo)<li>자바의 Object.hashCode() 함수는 데이터마다 다른 해시 반환 가능하므로 적합하지 않음</ul><li>각 파티션에 해시값 변위를 할당하고 해시값이 파티션의 범위에 속하는 모든 키를 그 파티션에 할당<li>키를 파티션 사이에 균일하게 분산시키는데 적합함<li>키의 해시값을 사용해서 파티셔닝하면 키 범위 파티셔닝의 장점인 효율적인 범위 질의가 불가능함<ul><li>인접했던 키가 여러 파티션에 흩어져 정렬 순서 유지 불가<li>몽고DB: 해시 기반 샤딩 모드를 활성화하면 범위 질의가 모든 파티션에 전송됨<li>리악/카우치베이스/볼드모트: 기본키에 대한 범위 질의 불가<li>카산드라<ul><li>두 가지 파티셔닝 전략 사이에서 타협<li>테이블을 선언할 때 복합 기본키 지정 가능<li>키의 첫 부분에만 해싱하고 파티션을 결정<li>남은 컬럼은 카산드라 SS테이블에서 데이터를 정렬하는 연쇄된 색인으로 사용<li>복합 키의 첫 번째 컬럼에 대해서는 값 범위로 검색하는 질의가 불가능하지만 첫 번재 컬럼에 고정된 값을 지정하면 다른 컬럼에 대해서는 범위 스캔을 효율적으로 실행 가능<li>연쇄된 색을 사용하여 일대다 관계를 표현하는 모델을 만들 수 있음<ul><li>소셜미디어 사용자 한 명이 수정한 문서 여러개를 올리기<li>user_id, updated_timestamp 키로 특정 사용자의 시간 범위 문서 읽기</ul></ul></ul></ul><h4 id="221-일관성-해싱"><span class="mr-2">2.2.1. 일관성 해싱</span><a href="#221-일관성-해싱" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>CDN 규모의 캐시 시스템에서 부하를 균등하게 분산시키는 방법<li>중앙 제어나 분산 합의가 필요하지 않도록 파티션 경계를 무작위로 선택<li>일관성: 복제 일관성이나 ACID 일관성과는 관련이 없으며 특별한 재균형화 방법을 의미<li>데이터베이스에서 실제로는 잘 동작하지 않아서 현실에서 거의 사용되지 않음<li>일관성 해싱이라는 단어 대신 해싱 파티셔닝이라고 하는게 더 좋음</ul><h3 id="23-쏠린-작업부하와-핫스팟-완화"><span class="mr-2">2.3. 쏠린 작업부하와 핫스팟 완화</span><a href="#23-쏠린-작업부하와-핫스팟-완화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>키를 해싱해서 파티션을 정하면 핫스팟을 줄이는데 도움이 되지만 항상 동일한 키를 읽고 쓰는 극단적인 상황에서는 모든 요청이 동일한 파티션으로 쏠리게 됨<li>현대의 데이터스시템 대부분은 크게 쏠린 부하를 자동으로 보정하지 못하므로 애플리케이션에서 쏠림을 완화해야함<ul><li>간단한 해결책은 키의 시작이나 끝에 임의 숫자를 붙이는 것<li>다른 키에 쪼개서 쓰면 읽기를 수행할 때 여러개의 키에 해당하는 데이터를 읽어서 조합하는 추가적인 작업이 필요해짐<li>요청이 몰리는 소수의 키에만 적용하는게 적절함<li>쓰기 처리량이 낮은 대다수의 키에도 적용하면 불필요한 오버헤드 발생</ul><li>애플리케이션에 대한 트레이드오프를 꼼꼼히 따져볼 필요가 있음</ul><h2 id="3-파티셔닝과-보조-색인"><span class="mr-2">3. 파티셔닝과 보조 색인</span><a href="#3-파티셔닝과-보조-색인" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>키-값 데이터 모델은 기본키를 통해서만 레코드에 접근한다면 키로부터 파티션을 결정하고 이를 사용해 해당 키를 담당하는 파티션으로 읽기, 쓰기 요청을 전달할 수 있음<li>보조 색인은 보통 레코드를 유일하게 식별하는 용도가 아니라 특정한 값이 발생한 항목을 검색하는 수단<li>보조 색인은 관계형 데이터베이스의 핵심 요소이며 문서 데이터베이스에서도 흔함<li>많은 키-값 저장소에서는 구현 복잡도가 추가되는 것을 피하려고 보조 색인을 지원하지 않지만 보조 색인은 데이터 모델링에 매우 유용하여 일부 저장소에서 추가함<li>보조 색인은 검색 서버에게는 <strong>존재의 이유</strong>임 (솔라, 엘라스틱 서치)<li>보조 색인은 파티션에 깔끔하게 대응되지 않는 문제점이 존재함</ul><h3 id="31-문서-기준-보조-색인-파티셔닝"><span class="mr-2">3.1. 문서 기준 보조 색인 파티셔닝</span><a href="#31-문서-기준-보조-색인-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>각 문서에는 고유 ID가 존재하고 문서 ID 기준으로 파티셔닝 됨<li>ID 외의 특정 필드로 데이터를 검색하려면 보조 색인이 필요함<li>색인을 선언하면 데이터베이스가 자동으로 색인 생성<li>이런 색인을 사용하면 각 파티션은 자신의 보조 색인을 유지하며 그 파티션에 속하는 문서만 담당<li>데이터베이스에 문서 쓰기 작업을 실행할 때에는 쓰려고하는 문서 ID를 포함하는 파티션만 다루면 됨<li>파티셔닝 색인은 지역 색인이라고 함<li>문서 ID에 뭔가 특별한 작업을 하지 않는다면 특정한 조건의 데이터가 동일한 파티션에 저장되리라는 보장이 없음<li>모든 파티션으로 질의를 보내고 얻은 결과를 모두 모아야 함<li>파티셔닝된 데이터베이스에 이런식으로 질의를 보내는 방법: 스캐터/개더 (scatter/gather)<li>보조 색인을 써서 읽는 질의는 큰 비용이 들 수 있음<li>데이터베이스 벤더들은 대부분 보조 색인 질의가 단일 파티션에만 실행되도록 파티셔닝 방식을 권장하지만 항상 가능하지는 않음<li>특히 단일 질의에서 여러 보조 색인을 사용한다면…</ul><h3 id="32-용어-기준-보조-색인-파티셔닝"><span class="mr-2">3.2. 용어 기준 보조 색인 파티셔닝</span><a href="#32-용어-기준-보조-색인-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>한 노드에만 색인을 저장하면 해당 노드가 병목이 되어 파티셔닝의 목적을 해칠 수 있음<li>전역 색인도 파티셔닝해야 하지만 기본키 색인과는 다른식으로 할 수 있음<li>알파벳 순처럼 특정 알파벳 범위에 따라 파티션을 나눌 수 있음<li>용어에 따라 색인의 파티션이 결정함 (term-partitioned)<li>용어: 문서에 등장하는 모든 단어 (전문 색인에서 나옴)<li>용어 자체, 용어의 해시값 사용 가능<li>용어 해시값을 사용하여 파티셔닝하면 부하가 좀 더 고르게 분산됨<li>문서 파티셔닝 색인에 비해 전역(용어 파티셔닝) 색인과 비교<ul><li>읽기: 용어를 포함하는 파티션으로만 요청을 보내면 됨<li>쓰기: 쓸 문서의 색인이 여러 파티션에 영향을 줄 수 있음</ul><li>용어 파티셔닝 색인을 사용하면 쓰기에 영향받는 모든 파티션에 걸친 분산 트랜잭션을 실행해야하는데 모든 데이터베이스에서 지원하지 않음<li>현실적으로는 전역 보조 색인은 대개 비동기로 갱신됨<li>다이나모DB는 전역 보조 색인을 갱신하는데 1초도 안걸리지만 인프라 결함이 생기면 지연이 길어질 수 있음<li>전역 용어 파티셔닝 색인의 다른 사용처로는 리악의 검색 기능, 오라클 데이터웨어하우스<li>오라클 웨어하우스는 지역 색인과 전역 색인 사이에서 선택 가능</ul><h2 id="4-파티션-재균형화"><span class="mr-2">4. 파티션 재균형화</span><a href="#4-파티션-재균형화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>시간이 지나면서 데이터베이스의 변화 발생<ul><li>부하가 늘어나 CPU 추가<li>데이터셋 크기 증가로 디스크, 램 추가<li>장비 장애로 교체</ul><li>이러한 변화가 발생하면 데이터와 요청이 한 노드에서 다른 노드로 옮겨져야 함<li>클러스터에서 한 노드가 담당하던 부하를 다른 노드로 옮기는 과정을 <strong>재균형화(rebalancing)</strong>이라고 함<li>재균형화 요구 사항<ul><li>부하가 클러스터 내 노드들에 균등하게 분배<li>재균형화 요청 중에도 읽기, 쓰기 요청을 받아야함<li>빠르게 재균형화되고 네트워크와 디스크 I/O 부하를 최소화할 수 있도록 데이터가 필요 이상으로 옮겨져서는 안됨</ul></ul><h3 id="41-재균형화-전략"><span class="mr-2">4.1. 재균형화 전략</span><a href="#41-재균형화-전략" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="411-쓰면-안되는-방법-해시값에-모드-n-연산을-실행"><span class="mr-2">4.1.1. 쓰면 안되는 방법: 해시값에 모드 N 연산을 실행</span><a href="#411-쓰면-안되는-방법-해시값에-모드-n-연산을-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>해시값 기준으로 파티셔닝할 때는 사용 가능한 해시값 범위를 나누고 각 범위를 한 파티션에 할당하는게 최선<li>모드 연산을 사용하지 않는 이유는 노드 개수가 바뀌면 대부분의 키가 노드 사이에 옮겨져야 함<li>재균형화 비용이 지나치게 커짐</ul><h4 id="412-파티션-개수-고정"><span class="mr-2">4.1.2. 파티션 개수 고정</span><a href="#412-파티션-개수-고정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>파티션을 노드 대수보다 많이 만들고 각 노드에 여러 파티션을 할당<li>노드가 추가되면 새 노드는 파티션이 다시 균일하게 분배될 때까지 기존 노드에서 파티션을 뺏어옴<li>노드가 제거되면 반대로 기존 노드에 파티션 할당<li>파티션은 노드 사이에서 이동만고 파티션 개수와 파티션 키는 변경되지 않음<li>유일한 변화는 노드에 어떤 파티션이 할당되는가 뿐<li>파티션 할당 변경은 네트워크를 통해 대량의 데이터를 전송해야 하므로 시간이 좀 걸리기 때문에 데이터 전송중인 동안에 읽기나 쓰기가 실행되면 기존 할당된 파티션을 사용<li>이론상으로 클러스터에 성능이 다른 하드웨어가 섞여있다면 성능이 좋은 노드에 파티션을 더 할당하여 부하를 분산할 수 있음<li>보통 데이터베이스가 처음 구축될 때 파티션 개수가 고정되고 이후에 변하지 않음<li>이론적으로는 파티션을 쪼개거나 합치는 게 가능하지만 파티션 개수가 고정되면 운영이 단순해지므로 고정 파티션을 사용하는 데이터베이스는 파티션 분할을 지원하지 않는 경우가 많음<li>처음 설정된 파티션 개수가 최대 노드 개수가 되므로 미래를 예측하여 충분히 높은 값으로 선택해야 함<li>너무 큰 수를 선택하면 개별 파티션 관리 오버헤드로 역효과가 발생할 수 있음<li>전체 데이터셋 크기 변동이 심하면 파티션 개수 예측이 어려움<li>파티션이 너무 크면 리밸런싱 때 노드 장애로부터 복구 비용이 커짐<li>파티션이 너무 작으면 오버헤드가 커짐</ul><h4 id="413-동적-파티셔닝"><span class="mr-2">4.1.3. 동적 파티셔닝</span><a href="#413-동적-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>키 범위 파티셔닝을 사용하면 파티션 경계와 개수가 고정되어 불편함<li>파티션 경계를 수동으로 잘못 지정하면 데이터가 A 파티션에 몰리고 B 파티션은 빌 수도 있음<li>HBase, 리싱크DB 처럼 키 범위 파티셔닝을 사용하는 데이터베이스는 파티션을 동적으로 생성<li>파티션 크기가 설정 값을 넘어서면 기존 파티션의 절반 정도의 파티션 두개로 쪼갬<li>데이터가 많이 삭제되어 파티션 크기가 임곗값 아래로 떨어지면 인접한 파티션과 합쳐질 수 있음<li>B트리 최상위 레벨에서 실행되는 작업과 유사<li>각 노드는 여러 파티션을 담당할 수 있음<li>큰 파티션이 쪼개진 후 부하 균형을 위해 분할된 파티션이 다른 노드로 이동될 수 있음<li>HBase의 경우 HDFS를 통해 파티션 파일이 전송됨<li>이점<ul><li>파티션 개수가 전체 데이터 용량에 맞춰 조정됨<li>데이터 양이 작으면 파티션 개수가 적어도 되어 오버헤드가 적음<li>데이터 양이 거대해지면 개별 파티션의 크기는 설정된 최대치로 제한</ul><li>단점<ul><li>빈 데이터베이스는 파티션 경계의 사전 정보가 없으므로 시작할 때는 파티션이 하나임<li>데이터셋이 작아지면 특정 노드만 트래픽을 받고 다른 노드들은 유휴 상태가 됨</ul><li>이 문제 완화를 위해 HBase, 몽고DB는 초기 파티션 집합 설정 가능 -&gt; 사전 분할<li>키 범위 파티셔닝의 경우 사전 분할을 하려면 키가 어떤 식으로 분할될지 미리 알아야 함</ul><h4 id="414-노드-비례-파티셔닝"><span class="mr-2">4.1.4 노드 비례 파티셔닝</span><a href="#414-노드-비례-파티셔닝" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ul><li>파티션 개수 고정: 파티션 크기가 데이터셋 크기에 비례함<li>동적 파티셔닝: 파티션 개수가 데이터셋 크기에 비례함<li>카산드라, 케타마에서 사용되는 방법은 파티션 개수가 노드 대수에 비례하게 함<li>노드 당 할당되는 파티션 개수 고정<li>노드 대수가 변함이 없다면 파티션 크기가 데이터셋 크기에 비례해서 증가<li>노드 대수를 늘리면 파티션 크기가 작아짐<li>개별 파티션 크기가 안정적으로 유지됨<li>새 노드가 추가되면 파티션을 무작위로 선택해 반으로 분할하여 새 노드에 할당<li>무작위로 선택하여 균등하지 않은 분할이 생길 수 있지만 평균적으로 기존 노드의 부하에서 균등한 몫을 할당 받음<li>카산드라 3.0에는 불균등한 분할을 회피할 수 있는 대안적인 재균형화 알고리즘 추가됨<li>파티션 경계를 무작위로 선택하려면 해시 기반 파티셔닝 사용<li>이 방법은 일관성 해싱의 원래 정의에 가장 가깝게 대응 (204p)<li>최근에 나온 해시 함수를 사용하면 메타데이터 오버헤드를 낮추면서도 비슷한 효과를 얻을 수 있음</ul><h3 id="42-운영-자동-재균형화와-수동-재균형화"><span class="mr-2">4.2. 운영: 자동 재균형화와 수동 재균형화</span><a href="#42-운영-자동-재균형화와-수동-재균형화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>완전 자동 재균형화, 완전 수동 재균형화 사이에 중간 지점이 있음<li>완전 자동 재균형화는 자동 장애 감지와 조합되면 더 위험할 수 있음<ul><li>노드 과부화로 일시적인 요청 지연<li>노드가 죽었다고 간주하고 자동 재균형화 하려고 함<li>과부화 걸린 노드, 다른 노드들, 네트워크 부하를 더한 연쇄 장애 가능성 존재</ul><li>재균형화에는 사람이 개입하는게 더 좋을 수 있음<li>카우치베이스, 리악, 볼드모트: 자동 파티션 할당을 제안하고 관리자가 확정해야함</ul><h2 id="5-요청-라우팅"><span class="mr-2">5. 요청 라우팅</span><a href="#5-요청-라우팅" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>여러 노드에 여러 파티션이 할당이 됨<li>클라이언트에서 요청을 보낼 때 어떤 노드에 요청을 해야할까?<li>데이터베이스에 국한되지 않은 일반적인 문제인 <strong>서비스 찾기(service discovery)</strong>의 일종<li>주키퍼 같은 코디네이션 서비스를 사용<li>각 노드는 주키퍼에 자신을 등록<li>주키퍼는 파티션과 노드 사이의 할당 정보를 관리<li>라우팅 계층이나 파티션 인지 클라이언트 같은 구성요소들은 주키퍼에 있는 정보를 구독할 수 있음<li>파티션 소유자 변경, 노드 추가/삭제 가 발생하면 주키퍼는 라우팅 계층에 알려서 라우팅 정보를 최신으로 유지할 수 있게 함<li>링크드인 에스프레소: 헬릭스로 클러스터 관리, 헬릭스는 주키퍼에 의존<li>HBase, 솔라클라우드, 카프카: 파티션 할당을 추적하는데 주키퍼 사용<li>몽고DB: 설정 서버 구현에 의존, 몽고스 데몬을 라우팅 계층으로 사용<li>카산드라, 리악: 가십 프로토콜을 사용하여 클러스터 상태 변화를 노드 사이에 전파, 외부 코디네이터 서비스에 의존하지 않음<li>카우치베이스: 재균형화를 자동으로 하지 않음. 클러스터 노드로부터 변경된 라우팅 정보를 알아내는 목시(moxi) 라우팅 계층 설정<li>클라이언트는 라우팅 게층을 사용하거나 임의 노드의 IP를 알아내야 함</ul><h3 id="51-병렬-질의-실행"><span class="mr-2">5.1. 병렬 질의 실행</span><a href="#51-병렬-질의-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>분석용 대규모 병렬 처리(massively parallel processing, MPP) 관게형 데이터베이스 제품은 훨씬 더 복잡한 질의 지원<li>MPP 질의 최적화기는 복잡한 질의를 여러 실행 단계와 파티션으로 분해하며 이들 중 다수는 데이터베이스 클러스터 내의 서로 다른 노드에서 병렬적으로 실행될 수 있음<li>데이터셋의 많은 부분을 스캔하는 연산을 포함하는 질의는 특히 병렬 실행의 혜택을 받음</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/study/'>Study</a>, <a href='/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%91%EC%8B%AC-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%A4%EA%B3%84/'>데이터 중심 어플리케이션 설계</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/study/" class="post-tag no-text-decoration" >study</a> <a href="/tags/data/" class="post-tag no-text-decoration" >data</a> <a href="/tags/design/" class="post-tag no-text-decoration" >design</a> <a href="/tags/architecture/" class="post-tag no-text-decoration" >architecture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=06장. 파티셔닝 - bveloper&amp;url=https://bswsw.github.io/posts/designing-data-chapter6/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=06장. 파티셔닝 - bveloper&amp;u=https://bswsw.github.io/posts/designing-data-chapter6/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://bswsw.github.io/posts/designing-data-chapter6/&amp;text=06장. 파티셔닝 - bveloper" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/designing-data-chapter9/">09장. 일관성과 합의</a><li><a href="/posts/designing-data-chapter8/">08장. 분산 시스템의 골칫거리</a><li><a href="/posts/designing-data-chapter7/">07장. 트랜잭션</a><li><a href="/posts/designing-data-chapter6/">06장. 파티셔닝</a><li><a href="/posts/designing-data-chapter5/">05장. 복제</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/livestudy/">livestudy</a> <a class="post-tag" href="/tags/whiteship/">whiteship</a> <a class="post-tag" href="/tags/learningscala/">learningscala</a> <a class="post-tag" href="/tags/scala/">scala</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/designing-data-chapter2/"><div class="card-body"> <em class="timeago small" data-ts="1731135600" > 2024-11-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>02장. 데이터 모델과 질의 언어</h3><div class="text-muted small"><p> 소프트웨어에서 데이터를 저장, 표현, 조작하는 다양한 방법을 알아보자. 관계형 모델 문서 모델 그래프 기반 데이터 모델 1. 관계형 모델과 문서 모델 1.1. 관계형 모델 메인프레임 컴퓨터에서 수행된 비즈니스 데이터 처리, 트랜잭션 처리, 일괄처리를 하기 위해 사용됨. 개발자는 DB 내부 데이터 표현에 대해 ...</p></div></div></a></div><div class="card"> <a href="/posts/designing-data-chapter3/"><div class="card-body"> <em class="timeago small" data-ts="1732204800" > 2024-11-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>03장. 저장소와 검색</h3><div class="text-muted small"><p> 데이터베이스 관점에서 데이터를 저장하는 방법과 데이터를 요청했을 때 다시 찾을 수 있는 방법에 대해 알아보자. 0. 개발자가 주의해야하는 이유 사용 가능한 여러 저장소 엔진 중에 어플리케이션에 적합한 엔진을 선택하는 것이 필요 특정 작업부하 유형에서 좋은 성능을 내게끔 저장소 엔진을 조정하려면 저장소 엔진이 내부에서 수행되는 작업에 ...</p></div></div></a></div><div class="card"> <a href="/posts/designing-data-chapter4/"><div class="card-body"> <em class="timeago small" data-ts="1732942800" > 2024-11-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>04장. 부호화와 발전</h3><div class="text-muted small"><p> Encoding and Evolution 데이터 부호화를 위한 다양한 형식으로 스키마가 변경되고 예전 버전과 새로운 버전의 데이터와 코드가 공존하는 시스템을 어떻게 지원하는지 알아보자. 하위 호환성: 새로운 코드는 예전 코드가 기록한 데이터를 읽을 수 있어야 한다. 상위 호환성: 에전 코드는 새로운 코드가 기록한 데이터를 읽을 수 있...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/designing-data-chapter5/" class="btn btn-outline-primary" prompt="이전 글"><p>05장. 복제</p></a> <a href="/posts/designing-data-chapter7/" class="btn btn-outline-primary" prompt="다음 글"><p>07장. 트랜잭션</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "bswsw/bswsw.github.io", "data-repo-id": "R_kgDOHbD5Uw", "data-category": "Announcements", "data-category-id": "DIC_kwDOHbD5U84CPetV", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "ko", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/bswsw">BAE SANGWOO</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/livestudy/">livestudy</a> <a class="post-tag" href="/tags/whiteship/">whiteship</a> <a class="post-tag" href="/tags/learningscala/">learningscala</a> <a class="post-tag" href="/tags/scala/">scala</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-153066340-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-153066340-1'); }); </script>
