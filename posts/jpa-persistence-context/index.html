<!DOCTYPE html><html lang="ko-KR" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[JPA] 영속성 컨텍스트 (Persistence Context) 특징" /><meta name="author" content="Bae Sangwoo" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="먼저 JPA란 Java Persistence API의 약자로 자바 ORM 기술에 대한 API 표준 명세이며 대표적인 구현체로는 Hibernate가 있습니다." /><meta property="og:description" content="먼저 JPA란 Java Persistence API의 약자로 자바 ORM 기술에 대한 API 표준 명세이며 대표적인 구현체로는 Hibernate가 있습니다." /><link rel="canonical" href="https://bswsw.github.io/posts/jpa-persistence-context/" /><meta property="og:url" content="https://bswsw.github.io/posts/jpa-persistence-context/" /><meta property="og:site_name" content="bveloper" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-01-12T18:26:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[JPA] 영속성 컨텍스트 (Persistence Context) 특징" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Bae Sangwoo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Bae Sangwoo"},"dateModified":"2020-01-12T18:26:00+09:00","datePublished":"2020-01-12T18:26:00+09:00","description":"먼저 JPA란 Java Persistence API의 약자로 자바 ORM 기술에 대한 API 표준 명세이며 대표적인 구현체로는 Hibernate가 있습니다.","headline":"[JPA] 영속성 컨텍스트 (Persistence Context) 특징","mainEntityOfPage":{"@type":"WebPage","@id":"https://bswsw.github.io/posts/jpa-persistence-context/"},"url":"https://bswsw.github.io/posts/jpa-persistence-context/"}</script><title>[JPA] 영속성 컨텍스트 (Persistence Context) 특징 | bveloper</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="bveloper"><meta name="application-name" content="bveloper"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/bveloper.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">bveloper</a></div><div class="site-subtitle font-italic">bveloper</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/bswsw" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['baegoony','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>[JPA] 영속성 컨텍스트 (Persistence Context) 특징</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[JPA] 영속성 컨텍스트 (Persistence Context) 특징</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/bswsw">BAE SANGWOO</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" data-ts="1578821160" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-01-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2721 단어"> <em>15 분</em>읽는 시간</span></div></div></div><div class="post-content"><p>먼저 JPA란 <a href="https://en.wikipedia.org/wiki/Jakarta_Persistence" target="_blank">Java Persistence API</a>의 약자로 자바 ORM 기술에 대한 API 표준 명세이며 대표적인 구현체로는 <a href="https://hibernate.org/" target="_blank">Hibernate</a>가 있습니다.</p><p>JPA에서 가장 중요한 개념 중 하나인 영속성 컨텍스트(Persistence Context)의 특징에 대해 함께 알아보겠습니다.</p><p>특징에는 크게 다섯 가지가 있습니다.</p><ul><li>1차 캐시 (<code class="language-plaintext highlighter-rouge">First Level Cache</code>)<li>동일성 보장 (<code class="language-plaintext highlighter-rouge">Identify</code>)<li>쓰기 지연 (<code class="language-plaintext highlighter-rouge">Write-behind</code>)<li>변경 감지 (<code class="language-plaintext highlighter-rouge">Dirty Checking</code>)<li>지연 로딩 (<code class="language-plaintext highlighter-rouge">Lazy Loading</code>)</ul><p>본격적으로 들어가기 전에 혹시 아래와 비슷한 코드를 보시거나 작성해보신 적이 있으신가요?</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="c1">// 이런 코드를 보신적이 있나요? </span>
<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nc">Array</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">emf</span> <span class="p">=</span> <span class="nc">Persistence</span><span class="p">.</span><span class="nf">createEntityManagerFactory</span><span class="p">(</span><span class="s">"default"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">em</span> <span class="p">=</span> <span class="n">emf</span><span class="p">.</span><span class="nf">createEntityManager</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">tx</span> <span class="p">=</span> <span class="n">em</span><span class="p">.</span><span class="n">transaction</span>

    <span class="n">tx</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">member</span> <span class="p">=</span> <span class="nc">Member</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
            <span class="n">name</span> <span class="p">=</span> <span class="s">"배모군"</span>
            <span class="n">address</span> <span class="p">=</span> <span class="s">"서울"</span>
        <span class="p">}</span>

        <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="nf">printStackTrace</span><span class="p">()</span>
        <span class="n">tx</span><span class="p">.</span><span class="nf">rollback</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="n">em</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">emf</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>만약 위와 같은 코드를 처음 보신다면 JPA에 대해 더 학습이 필요할 수 있습니다.</p><p>요즘은 스프링 부트와 <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#reference" target="_blank">Spring Data JPA</a>에서 제공하는 추상화한 <code class="language-plaintext highlighter-rouge">Repository</code>를 사용하여 개발을 하는 경우가 많지만</p><p>실제 구현체는 위와 같은 코드와 비슷하게 작성되어 있습니다.</p><p>그래서 샘플 코드는 직접 <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html" target="_blank">EntityManager</a>를 사용하여 작성하였습니다.</p><h1 id="프로젝트-구성">프로젝트 구성</h1><p>말씀드린대로 <code class="language-plaintext highlighter-rouge">EntityManager</code>를 직접 사용하여 샘플 코드를 작성하였지만 설정의 편의를 위하여</p><p>Spring Data JPA Starter를 의존성으로 넣고 스프링 부트에서 사용하는 <code class="language-plaintext highlighter-rouge">application.yml</code>로 설정 하였습니다.</p><p>또한 자바가 아닌 코틀린으로 작성하니 참고 바랍니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="c1">// build.gradle.kts</span>

<span class="nf">plugins</span> <span class="p">{</span>
    <span class="nf">kotlin</span><span class="p">(</span><span class="s">"jvm"</span><span class="p">)</span> <span class="n">version</span> <span class="s">"1.3.61"</span>
    <span class="nf">kotlin</span><span class="p">(</span><span class="s">"plugin.spring"</span><span class="p">)</span> <span class="n">version</span> <span class="s">"1.3.61"</span>
    <span class="nf">kotlin</span><span class="p">(</span><span class="s">"plugin.jpa"</span><span class="p">)</span> <span class="n">version</span> <span class="s">"1.3.61"</span>

    <span class="nf">id</span><span class="p">(</span><span class="s">"org.springframework.boot"</span><span class="p">)</span> <span class="n">version</span> <span class="s">"2.2.2.RELEASE"</span>

    <span class="n">idea</span>
<span class="p">}</span>

<span class="nf">apply</span> <span class="p">{</span>
    <span class="nf">plugin</span><span class="p">(</span><span class="s">"io.spring.dependency-management"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">allOpen</span> <span class="p">{</span>
    <span class="k">annotation</span><span class="p">(</span><span class="s">"javax.persistence.Entity"</span><span class="p">)</span>
    <span class="k">annotation</span><span class="p">(</span><span class="s">"javax.persistence.MappedSuperclass"</span><span class="p">)</span>
    <span class="k">annotation</span><span class="p">(</span><span class="s">"javax.persistence.Embeddable"</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">group</span> <span class="p">=</span> <span class="s">"dev.baesangwoo"</span>
<span class="n">version</span> <span class="p">=</span> <span class="s">"1.0-SNAPSHOT"</span>

<span class="nf">repositories</span> <span class="p">{</span>
    <span class="nf">mavenCentral</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">dependencies</span> <span class="p">{</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="nf">kotlin</span><span class="p">(</span><span class="s">"stdlib-jdk8"</span><span class="p">))</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="nf">kotlin</span><span class="p">(</span><span class="s">"reflect"</span><span class="p">))</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.springframework.boot:spring-boot-starter-data-jpa"</span><span class="p">)</span>
    <span class="nf">runtimeOnly</span><span class="p">(</span><span class="s">"mysql:mysql-connector-java"</span><span class="p">)</span>

    <span class="nf">testImplementation</span><span class="p">(</span><span class="s">"org.springframework.boot:spring-boot-starter-test"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">exclude</span><span class="p">(</span><span class="n">group</span> <span class="p">=</span> <span class="s">"org.junit.vintage"</span><span class="p">,</span> <span class="n">module</span> <span class="p">=</span> <span class="s">"junit-vintage-engine"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">tasks</span> <span class="p">{</span>
    <span class="nf">compileKotlin</span> <span class="p">{</span>
        <span class="nf">kotlinOptions</span> <span class="p">{</span>
            <span class="n">freeCompilerArgs</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"-Xjsr305=strict"</span><span class="p">)</span>
            <span class="n">jvmTarget</span> <span class="p">=</span> <span class="s">"1.8"</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">compileTestKotlin</span> <span class="p">{</span>
        <span class="nf">kotlinOptions</span> <span class="p">{</span>
            <span class="n">freeCompilerArgs</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"-Xjsr305=strict"</span><span class="p">)</span>
            <span class="n">jvmTarget</span> <span class="p">=</span> <span class="s">"1.8"</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">test</span> <span class="p">{</span>
        <span class="nf">useJUnitPlatform</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1"># resources/application.yml</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/test</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">dialect</span><span class="pi">:</span> <span class="s">org.hibernate.dialect.MySQL5InnoDBDialect</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">format_sql</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">use_sql_comments</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">hibernate</span><span class="pi">:</span>
      <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">create</span>
    <span class="na">show-sql</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">logging.level.org.hibernate.type.descriptor.sql.BasicBinder</span><span class="pi">:</span> <span class="s">trace</span>
</pre></table></code></div></div><h1 id="entity-작성">Entity 작성</h1><p>1:n 구조를 갖는 <code class="language-plaintext highlighter-rouge">Entity</code> 두 가지를 간단히 작성하였습니다.</p><p>또한 쓰기 지연의 재현을 눈으로 보기 쉽게 <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Id.html" target="_blank">@Id</a> 필드에 <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html" target="_blank">@GeneratedValue</a>를 선언하지 않았습니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Team</span><span class="p">(</span>
    <span class="nd">@Id</span>
    <span class="kd">var</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
    <span class="kd">var</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"MEMBER"</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">Member</span><span class="p">(</span>
    <span class="nd">@Id</span>
    <span class="kd">var</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
    <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span> <span class="p">=</span> <span class="nc">FetchType</span><span class="p">.</span><span class="nc">LAZY</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">team</span><span class="p">:</span> <span class="nc">Team</span><span class="p">,</span>
    <span class="kd">var</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">var</span> <span class="py">address</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

</pre></table></code></div></div><h1 id="테스트-코드-작성">테스트 코드 작성</h1><p>테스트를 위해 <a href="https://junit.org/junit5/docs/current/user-guide/" target="_blank">JUnit5</a>를 사용하였고 JPA만 테스트하기 위해 <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/orm/jpa/DataJpaTest.html" target="_blank">@DataJpaTest</a>를 사용 하였습니다.</p><p>대략적인 구성은 아래와 같습니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="nd">@ExtendWith</span><span class="p">(</span><span class="nc">SpringExtension</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <span class="c1">// junit5</span>
<span class="nd">@DataJpaTest</span>
<span class="nd">@AutoConfigureTestDatabase</span><span class="p">(</span><span class="n">replace</span> <span class="p">=</span> <span class="nc">AutoConfigureTestDatabase</span><span class="p">.</span><span class="nc">Replace</span><span class="p">.</span><span class="nc">NONE</span><span class="p">)</span> <span class="c1">// 테스트 데이터베이스를 h2로 변경하지 않음</span>
<span class="nd">@Rollback</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="c1">// 테스트 후 롤백하지 않음</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"영속성 컨텍스트 테스트"</span><span class="p">)</span>
<span class="k">internal</span> <span class="kd">class</span> <span class="nc">PersistenceContextTest</span> <span class="p">{</span>

    <span class="nd">@PersistenceContext</span> <span class="c1">// 기본 엔티티매니저</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">em</span><span class="p">:</span> <span class="nc">EntityManager</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"1차 캐시 테스트"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">testFirstLevelCache</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// code ..</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"동일성 테스트"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">testIdentity</span><span class="p">()</span> <span class="p">{</span>
    	<span class="c1">// code ..</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"쓰기 지연 테스트"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">testWriteBehind</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// code ..</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"변경 감지 테스트"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">testDirtyChecking</span><span class="p">()</span> <span class="p">{</span>
    	<span class="c1">// code ..</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"지연 로딩 테스트"</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">testLazyLoading</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// code ..</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이제부터 영속성 컨텍스트의 각 특징을 재현과 함께 설명 해보겠습니다. :)</p><h1 id="1차-캐시-first-level-cache">1차 캐시 (First Level Cache)</h1><p>영속화된 엔티티를 저장하여 @id값이 같은 엔티티를 찾을 때 직접 DB에 쿼리 실행을 요청하지 않고 엔티티가 저장된 공간에서 가져오게 되는데 이 공간을 1차 캐시라 합니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"1차 캐시 테스트"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">testFirstLevelCache</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">randomNum</span> <span class="p">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">..</span><span class="mi">200L</span><span class="p">).</span><span class="nf">random</span><span class="p">()</span>

    <span class="n">team</span> <span class="p">=</span> <span class="nc">Team</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">randomNum</span><span class="p">,</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"팀_$randomNum"</span>
    <span class="p">)</span>

    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>

    <span class="c1">// select 쿼리가 실행되지 않고 1차 캐시에서 가져옴.</span>
    <span class="n">em</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nc">Team</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/2020-01-12-jpa-persistence-context/first-level-cache.png" alt="" data-proofer-ignore> <em>1차 캐시 테스트 결과</em></p><p>위 코드를 실행하면 <code class="language-plaintext highlighter-rouge">find</code> 구문이 있지만 <code class="language-plaintext highlighter-rouge">select</code> 쿼리가 실행되지 않는 것을 확인할 수 있습니다.</p><p>이미 1차 캐시에 동일한 아이디를 가지고 있는 엔티티가 존재하기때문에 데이터베이스로 쿼리를 요청하지 않고 캐시를 가져옵니다.</p><h1 id="동일성-보장-identity">동일성 보장 (Identity)</h1><p>동일한 <code class="language-plaintext highlighter-rouge">@id</code>값으로 검색한 엔티티는 동일성이 보장됩니다.</p><p>마치 리스트에서 데이터를 가져오듯 <code class="language-plaintext highlighter-rouge">@id</code>값이 동일하다면 해당 엔티티의 동일성을 보장해줍니다.</p><p>즉, 동일한 레퍼런스라는 뜻입니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"동일성 테스트"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">testIdentity</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">randomNum</span> <span class="p">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">..</span><span class="mi">200L</span><span class="p">).</span><span class="nf">random</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">team</span> <span class="p">=</span> <span class="nc">Team</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">randomNum</span><span class="p">,</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"팀_$randomNum"</span>
    <span class="p">)</span>

    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>

    <span class="c1">// select 쿼리가 실행되지 않고 1차 캐시에서 가져옴.</span>
    <span class="kd">val</span> <span class="py">findTeam</span> <span class="p">=</span> <span class="n">em</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nc">Team</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="n">team</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1">// 동등성 (equality)</span>
    <span class="nf">assertEquals</span><span class="p">(</span><span class="n">findTeam</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span>
    <span class="c1">// 동일성 (identity)</span>
    <span class="nf">assertSame</span><span class="p">(</span><span class="n">findTeam</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/2020-01-12-jpa-persistence-context/identity.png" alt="" data-proofer-ignore> <em>동일성 테스트 결과</em></p><p>영속화된 객체를 1차캐시에서 가져와 비교를하면 동등성은 물론이고 동일성까지 보장되어 테스트가 성공하는 것을 볼 수 있습니다.</p><h1 id="쓰기-지연-write-behind">쓰기 지연 (Write-behind)</h1><p>한 트랜잭션안에서 여러번 <code class="language-plaintext highlighter-rouge">persist</code> 메소드를 호출하여 DB에 저장을 시도할 때 <code class="language-plaintext highlighter-rouge">persist</code> 함수가 호출된 시점이 아닌</p><p>트렌잭션이 커밋되는 시점에 한 번에 insert 쿼리가 실행되어 네트워크 비용을 줄일 수 있고</p><p>트랜잭션이 커밋되지 않거나 중간에 의도치 않은 익셉션이 발생하면 트렌잭션이 롤백이되어 DB에 데이터가 반영되지 않습니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"쓰기 지연 테스트"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">testWriteBehind</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"========================"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">myTeam</span> <span class="p">=</span> <span class="nc">Team</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="mi">2929494L</span><span class="p">,</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"쓰기지연팀"</span>
    <span class="p">)</span>

    <span class="c1">// 쿼리가 출력문 사이에 찍히지 않고 트랜잭션이 커밋될 때 (메소드 끝) 찍힘</span>
    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">myTeam</span><span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"========================"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/2020-01-12-jpa-persistence-context/write-behind.png" alt="" data-proofer-ignore> <em>쓰기 지연 테스트 결과</em></p><p>코드에서는 출력문 사이에 <code class="language-plaintext highlighter-rouge">persist</code> 메소드가 작성되어 있지만 실제 쿼리는 그 뒤에 찍히는 것이 보입니다.</p><p>정확히는 커밋 시점에 찍히는데 <em>이 테스트에서는 메소드 종료 시점이 커밋 시점입니다.</em></p><h1 id="변경-감지-dirty-checking">변경 감지 (Dirty Checking)</h1><p>영속화된 엔티티의 값을 변경한다면 다시 <code class="language-plaintext highlighter-rouge">persist</code> 메소드를 호출하여 DB에 명령을 보내는 것이 아니라</p><p>트렌잭션이 커밋되는 시점에 엔티티의 데이터가 변경이 되었다면 update 쿼리 실행을 요청합니다.</p><p>이는 1차 캐시에 영속화 시점의 스냅샷이 존재하기 때문입니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"변경 감지 테스트"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">testDirtyChecking</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">randomNum</span> <span class="p">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">..</span><span class="mi">200L</span><span class="p">).</span><span class="nf">random</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">team</span> <span class="p">=</span> <span class="nc">Team</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">randomNum</span><span class="p">,</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"팀_$randomNum"</span>
    <span class="p">)</span>

    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
    
    <span class="c1">// 프로퍼티의 값을 변경만 하면 종료 전 변경된 사항을 커밋할떄 판단하여 update 쿼리 실행</span>
    <span class="n">team</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">"TD"</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/2020-01-12-jpa-persistence-context/dirty-checking.png" alt="" data-proofer-ignore> <em>변경 감지 테스트 결과</em></p><p>로그에 보이듯 값을 변경 후 다시 <code class="language-plaintext highlighter-rouge">persist</code> 메소드를 호출하지 않아도 업데이트 쿼리가 실행되는 것을 볼 수 있습니다. 영속성 컨텍스트에서 커밋 시점에 스냅샷과 비교하여 변경 사항이 있을 경우에만 업데이트 쿼리를 요청합니다.</p><h1 id="지연-로딩-lazy-loading">지연 로딩 (Lazy Loading)</h1><p><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/ManyToOne.html" target="_blank">@ManyToOne</a> 등 의 엔티티간 연관 관계가 맺어져 있는 엔티티를 검색할 때 연관 관계가 있는 엔티티는</p><p>프록시 데이터로 채우고 실제로 사용할 때 검색하게 하는 지연 로딩이 되어 불필요한 쿼리를 실행하지 않게 도와 줍니다.</p><p>필요에 따라서는 연관 관계가 있는 엔티티와 Join 하는 쿼리로 실행시킬 수도 있으나</p><p><em>기본적으로는 지연 로딩을 사용하는게 애플리케이션 성능 향상에 도움이 됩니다.</em></p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="nd">@DisplayName</span><span class="p">(</span><span class="s">"지연 로딩 테스트"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">testLazyLoading</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">randomNum</span> <span class="p">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">..</span><span class="mi">200L</span><span class="p">).</span><span class="nf">random</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">team</span> <span class="p">=</span> <span class="nc">Team</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">randomNum</span><span class="p">,</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"팀_$randomNum"</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">member</span> <span class="p">=</span> <span class="nc">Member</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="n">randomNum</span><span class="p">,</span>
        <span class="n">team</span> <span class="p">=</span> <span class="n">team</span><span class="p">,</span> <span class="c1">// n:1 엔티티 주입</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"배모군_$randomNum"</span><span class="p">,</span>
        <span class="n">address</span> <span class="p">=</span> <span class="s">"서울_$randomNum"</span>
    <span class="p">)</span>

    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>
    <span class="n">em</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>

    <span class="c1">// flush를 실행하면 쌓인 쿼리를 실행합니다.</span>
    <span class="n">em</span><span class="p">.</span><span class="nf">flush</span><span class="p">()</span>
    <span class="c1">// clear를 실행하면 영속성 컨텍스트가 가지고 있는 엔티티를 모두 제거합니다. (1차 캐시 정리)</span>
    <span class="n">em</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">findMember</span> <span class="p">=</span> <span class="n">em</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nc">Member</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="n">member</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Member에서 Team을 참조하기 전 : ${findMember.address}"</span><span class="p">)</span>

    <span class="c1">// team을 참조할 때 team select 쿼리가 실행됨</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Member에서 Team 참조 : ${findMember.team.name}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/2020-01-12-jpa-persistence-context/lazy-loading.png" alt="" data-proofer-ignore> <em>지연 로딩 테스트 결과</em></p><p><code class="language-plaintext highlighter-rouge">Member</code> 엔티티를 조회 후 실제로 <code class="language-plaintext highlighter-rouge">Team</code> 엔티티의 값을 사용할 때 <code class="language-plaintext highlighter-rouge">Team</code>을 조회하는 쿼리가 실행되는 것을 볼 수 있습니다.</p><p>단, <code class="language-plaintext highlighter-rouge">@ManyToOne</code> 애노테이션에 fetch 조건을 <code class="language-plaintext highlighter-rouge">Lazy</code>로 선언해 주셔야 가능합니다.</p><p>이렇게 간단하게 영속성 컨텍스트의 다섯가지 특징을 간단히 알아봤습니다.</p><p>애플리케이션의 성능 향상의 방법은 다양하게 존재하지만 JPA를 사용한다면</p><p>이 다섯 가지 특징을 잘 이해하고 사용하면 좋은 알고리즘 만큼 큰 성능 향상을 느낄 수 있을 것이라고 생각합니다.</p><p>더불어 JPA를 공부하고 싶은 분들께 누구나 추천하는 <a href="http://www.acornpub.co.kr/book/jpa-programmig" target="_blank">이 책</a>을 추천 드리며 이만 마치겠습니다.</p><p>감사합니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a> <a href="/tags/persistence/" class="post-tag no-text-decoration" >persistence</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[JPA] 영속성 컨텍스트 (Persistence Context) 특징 - bveloper&amp;url=https://bswsw.github.io/posts/jpa-persistence-context/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[JPA] 영속성 컨텍스트 (Persistence Context) 특징 - bveloper&amp;u=https://bswsw.github.io/posts/jpa-persistence-context/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://bswsw.github.io/posts/jpa-persistence-context/&amp;text=[JPA] 영속성 컨텍스트 (Persistence Context) 특징 - bveloper" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/designing-data-chapter9/">09장. 일관성과 합의</a><li><a href="/posts/designing-data-chapter8/">08장. 분산 시스템의 골칫거리</a><li><a href="/posts/designing-data-chapter7/">07장. 트랜잭션</a><li><a href="/posts/designing-data-chapter6/">06장. 파티셔닝</a><li><a href="/posts/designing-data-chapter5/">05장. 복제</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/livestudy/">livestudy</a> <a class="post-tag" href="/tags/whiteship/">whiteship</a> <a class="post-tag" href="/tags/learningscala/">learningscala</a> <a class="post-tag" href="/tags/scala/">scala</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jpa-entity/"><div class="card-body"> <em class="timeago small" data-ts="1580995020" > 2020-02-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] 엔티티 작성 시 주의 사항 (feat. 스프링 부트, 코틀린)</h3><div class="text-muted small"><p> 단일 데이터 소스를 사용하고 특별한 조건이 없으면서 스프링 부트를 사용한다면 JPA를 설정하는 것은 매우 간편합니다. 그러나 기본적인 엔티티 작성 방법 외에 사용 시 주의해야 할 사항들이 있어 정리해봅니다. 개인적인 관점에서 필요하다 생각하는 주의 사항이므로 잘못된 방법이라면 댓글로 지적 부탁드립니다. 또는 추가적으로 주의 사항이 있다면 댓글로 ...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-querydsl/"><div class="card-body"> <em class="timeago small" data-ts="1581952680" > 2020-02-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[JPA] Spring Data JPA와 Querydsl (feat. Spring MVC)</h3><div class="text-muted small"><p> EntityListener 1 2 3 4 5 6 7 @PrePersist @PostPersist @PreUpdate @PostUpdate @PreRemove @PostRemove @PostLoad AttributeConverter 1 2 3 4 5 6 7 8 9 10 11 12 13 @Converter class SnackNutrientConv...</p></div></div></a></div><div class="card"> <a href="/posts/designing-data-chapter10/"><div class="card-body"> <em class="timeago small" data-ts="1745640000" > 2025-04-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>10장. 일괄 처리</h3><div class="text-muted small"><p> 0. 일괄 처리 일괄 처리는 대규모 데이터를 처리하는 중요한 방식으로, 서비스(온라인), 일괄 처리(오프라인), 스트림 처리(준실시간)와 구분한다. 일괄 처리 시스템은 대용량 입력 데이터를 받아 처리하고 결과 데이터를 생산하며, 작업 시간이 길어 사용자의 즉각적인 대기 없이 반복적인 일정으로 수행된다. 주요 성능 지표는 처리량이다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/spring-core-bean/" class="btn btn-outline-primary" prompt="이전 글"><p>[Spring] 스프링 AOP 초간단 예제 (애노테이션 기반)</p></a> <a href="/posts/jpa-entity/" class="btn btn-outline-primary" prompt="다음 글"><p>[JPA] 엔티티 작성 시 주의 사항 (feat. 스프링 부트, 코틀린)</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "bswsw/bswsw.github.io", "data-repo-id": "R_kgDOHbD5Uw", "data-category": "Announcements", "data-category-id": "DIC_kwDOHbD5U84CPetV", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "ko", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/bswsw">BAE SANGWOO</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/livestudy/">livestudy</a> <a class="post-tag" href="/tags/whiteship/">whiteship</a> <a class="post-tag" href="/tags/learningscala/">learningscala</a> <a class="post-tag" href="/tags/scala/">scala</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/design/">design</a> <a class="post-tag" href="/tags/study/">study</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-153066340-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-153066340-1'); }); </script>
